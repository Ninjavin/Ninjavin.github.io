name: Add Daily Link To Queue

on:
  workflow_dispatch:
    inputs:
      title:
        description: "Link title"
        required: true
        type: string
      url:
        description: "Full URL (https://...)"
        required: true
        type: string
      description:
        description: "Short description (optional)"
        required: false
        type: string
      type:
        description: "Entry type"
        required: true
        type: choice
        options:
          - article
          - video
          - tool

permissions:
  contents: write

jobs:
  enqueue-link:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: "3.3"
          bundler-cache: false

      - name: Add link to queue
        env:
          INPUT_TITLE: ${{ github.event.inputs.title }}
          INPUT_URL: ${{ github.event.inputs.url }}
          INPUT_DESCRIPTION: ${{ github.event.inputs.description }}
          INPUT_TYPE: ${{ github.event.inputs.type }}
        run: |
          ruby scripts/add_daily_link_to_queue.rb \
            --title "$INPUT_TITLE" \
            --url "$INPUT_URL" \
            --description "${INPUT_DESCRIPTION:-}" \
            --type "$INPUT_TYPE"

      - name: Commit and push changes
        run: |
          if git diff --quiet; then
            echo "No changes to commit"
            exit 0
          fi

          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add _data/daily_links_queue.yml
          git commit -m "chore(daily): enqueue link for ${{ github.event.inputs.title }}"
          git push
